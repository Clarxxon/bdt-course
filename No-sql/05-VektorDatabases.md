
---

# Векторные базы данных: Подробная лекция

## Оглавление

1.  [Введение](#введение)
2.  [Что такое векторные представления?](#что-такое-векторные-представления)
3.  [Что такое векторная база данных?](#что-такое-векторная-база-данных)
4.  [Ключевые концепции](#ключевые-концепции)
    *   [Векторные эмбеддинги](#векторные-эмбеддинги)
    *   [Метрики сходства](#метрики-сходства)
    *   [Поиск ближайших соседей](#поиск-ближайших-соседей)
5.  [Как работает векторная БД?](#как-работает-векторная-бд)
6.  [Архитектура векторной БД](#архитектура-векторной-бд)
7.  [Сравнение с традиционными БД](#сравнение-с-традиционными-бд)
8.  [Популярные векторные БД](#популярные-векторные-бд)
9.  [Применение и Use Cases](#применение-и-use-cases)
10. [Заключение](#заключение)

---

## Введение

В эпоху искусственного интеллекта и больших данных мы все чаще имеем дело с неструктурированной информацией: текст, изображения, видео, аудио. Традиционные реляционные базы данных, отлично справляющиеся с табличными данными, оказываются неэффективными для поиска смысловых связей в таких данных.

На смену им приходят **векторные базы данных** (Vector Databases) — специализированные системы, предназначенные для хранения, управления и поиска по сложным данным через их векторные представления.

## Что такое векторные представления?

Прежде чем говорить о базах данных, нужно понять основную идею.

**Векторное представление (Embedding)** — это массив чисел (вектор), который в сжатой форме описывает семантические характеристики объекта.

*   **Текст:** Слово, предложение или документ преобразуется в вектор. Смыслово близкие слова (например, "король" и "монарх") будут иметь близкие векторные представления.
*   **Изображение:** Картинка пропускается через нейронную сеть (например, ResNet), которая генерирует вектор, описывающий ее содержание.
*   **Аудио:** Звуковой файл может быть представлен вектором, кодирующим тембр, высоту тона и другие характеристики.

Эти векторы существуют в многомерном пространстве (часто от 100 до 1000+ измерений). Чем "ближе" векторы в этом пространстве, тем более схожи объекты, которые они представляют.

> **Аналогия:** Представьте, что все слова — это точки на карте. Слова "яблоко" и "груша" будут расположены рядом в регионе "фрукты", а "автомобиль" и "велосипед" — в регионе "транспорт". Векторная БД — это сверхбыстрая и умная карта, которая может мгновенно найти все точки рядом с заданной.

## Что такое векторная база данных?

**Векторная база данных** — это специализированная система управления базами данных, предназначенная для:
1.  **Хранения** векторных представлений объектов вместе с их метаданными.
2.  **Эффективного поиска** (`Similarity Search`) — нахождения векторов, наиболее близких к заданному вектору-запросу.

Главная задача векторной БД — быстро и точно ответить на вопрос: **"Что больше всего похоже на это?"**.

## Ключевые концепции

### Векторные эмбеддинги

Это основа основ. Эмбеддинги создаются с помощью **моделей** (например, `word2vec`, `BERT`, `OpenAI Embeddings`, `CLIP`).
*   `"кот"` -> `[0.15, -0.82, 0.47, ..., 0.03]` (вектор из 384 чисел)
*   `"кошка"` -> `[0.14, -0.80, 0.45, ..., 0.04]` (вектор будет очень похож на вектор "кот")
*   `"автомобиль"` -> `[-0.78, 0.62, -0.01, ..., -0.55]` (вектор будет сильно отличаться)

### Метрики сходства

Чтобы измерить "близость" векторов, используются математические метрики:

1.  **Косинусное сходство (Cosine Similarity):** Измеряет косинус угла между векторами. Наиболее популярна для текстовых данных, так как игнорирует длину вектора и focuses на их направлении. Диапазон: от -1 до 1 (1 — идентичные направления).
2.  **Евклидово расстояние (Euclidean Distance / L2):** Измеряет "прямое" расстояние между точками в пространстве. Чем меньше расстояние, тем более схожи векторы.
3.  **Скалярное произведение (Dot Product):** Чем больше результат, тем более схожи векторы. Эффективно, если векторы нормализованы.

Выбор метрики зависит от задачи и модели, которая генерировала эмбеддинги.

### Поиск ближайших соседей

Задача поиска k ближайших соседей (k-NN) — это вычислительно сложная операция, особенно в высокоразмерных пространствах. Наивный подход (сравнить запрос с каждым вектором в базе) не масштабируется.

Поэтому используются приближенные методы (**Approximate Nearest Neighbors, ANN**), которые жертвуют идеальной точностью ради огромного прироста скорости.

**Популярные алгоритмы индексирования для ANN:**

*   **HNSW (Hierarchical Navigable Small World):** Графовый алгоритм, один из самых быстрых и точных на сегодня. Создает многослойный граф, где поиск начинается с верхних (редких) слоев и опускается вниз.
*   **IVF (Inverted File Index):** Пространство делится на кластеры (воронки). Поиск происходит только в наиболее подходящих кластерах.
*   **PQ (Product Quantization):** Техника сжатия векторов, которая позволяет хранить их в оперативной памяти и ускоряет вычисление расстояний.
*   **LSH (Locality-Sensitive Hashing):** Хеширует похожие векторы в один и тот же "бакет", что позволяет быстро находить кандидатов.

## Как работает векторная БД?

Типичный процесс работы:

1.  **Генерация эмбеддингов:** Ваши данные (документы, изображения и т.д.) пропускаются через модель эмбеддингов. Это можно делать как на стороне приложения, так и иногда средствами самой БД.
2.  **Индексирование:** Векторы и связанные с ними метаданные (ID, исходный текст, теги) загружаются в векторную БД. БД строит специальный индекс (например, HNSW) для последующего быстрого поиска.
3.  **Запрос:** Приложение отправляет запрос в векторную БД. Запросом может быть:
    *   Вектор.
    *   Исходный объект (текст, изображение), который БД сама преобразует в вектор (если поддерживается).
4.  **Поиск и возврат результатов:** Векторная БД использует свой индекс для выполнения поиска ближайших соседей по выбранной метрике. Она возвращает список идентификаторов и/или метаданных наиболее релевантных объектов, отсортированных по степени сходства.

## Архитектура векторной БД

Современные векторные БД — это не просто библиотеки для поиска, а полноценные распределенные системы.

```
[ Клиентское приложение ]
          |
[ REST / gRPC API ]
          |
[ Координатор / Менеджер запросов ]  (Распределяет запросы по узлам)
          |
    +------------+
    |            |
[ Узел 1 ]   [ Узел 2 ]   ... [ Узел N ]  (Шардирование данных)
    |            |
[ Индексы ]  [ Индексы ]     (HNSW, IVF-PQ на каждом узле)
    |            |
[ Хранилище ] [Хранилище]    (Векторы + метаданные на диске/в памяти)
```

*   **Горизонтальное масштабирование:** Данные могут быть разделены (шардированы) между множеством серверов.
*   **Отказоустойчивость:** Репликация данных обеспечивает надежность.
*   **Гибридные запросы:** Возможность комбинировать векторный поиск с фильтрацией по метаданным (например, "найди похожие кроссовки, которые есть в наличии и стоят до 100$").

## Сравнение с традиционными БД

| Характеристика | Традиционная БД (SQL/NoSQL) | Векторная БД |
| :--- | :--- | :--- |
| **Основной запрос** | `WHERE field = value`, `JOIN` | `ORDER BY vector_distance(...)` |
| **Тип данных** | Строки, числа, JSON | Векторы (массивы чисел) |
| **Сильные стороны** | Точное совпадение, транзакции (ACID) | Семантический поиск, нечеткое соответствие |
| **Сценарии использования** | Интернет-магазины, банковские системы, CRM | Поиск по смыслу, рекомендации, RAG для LLM |
| **Индексирование** | B-деревья, хэш-индексы | HNSW, IVF, PQ (ANN-индексы) |

## Популярные векторные БД

1.  **Pinecone:** Полностью управляемая облачная векторная БД. Простота использования, высокая производительность.
2.  **Weaviate:** Опенсорсная векторная БД с богатым функционалом. Поддерживает гибридный поиск (векторный + ключевые слова). Может самостоятельно генерировать эмбеддинги.
3.  **Chroma:** Легковесная, опенсорсная БД, ориентированная на разработчиков. Отлично подходит для прототипирования и RAG-систем.
4.  **Qdrant:** Высокопроизводительная опенсорсная векторная БД на Rust. Богатый API и удобная облачная версия.
5.  **Milvus / Zilliz:** Мощная распределенная опенсорсная платформа (Milvus) и ее коммерческая версия (Zilliz Cloud). Предназначена для работы с огромными объемами данных.
6.  **pgvector:** Расширение для PostgreSQL. Позволяет добавлять векторный поиск в уже существующую реляционную БД. Идеально для постепенного внедрения.

## Применение и Use Cases

1.  **Семантический поиск:**
    *   Поиск продуктов по описанию, а не только по названию.
    *   Поиск документов в интранете по смыслу.

2.  **Рекомендательные системы:**
    *   "Похожие товары", "Похожие фильмы" на основе их контента.

3.  **Поиск по изображениям и видео:**
    *   "Найди все изображения с пляжами".
    *   Поиск товаров по фото.

4.  **Поиск дубликатов и модерация:**
    *   Обнаружение почти идентичных изображений или текстов (например, для борьбы с мошенничеством).

5.  **RAG (Retrieval-Augmented Generation) для LLM:**
    *   **Это самый популярный кейс сегодня.** Векторная БД используется как "долговременная память" для больших языковых моделей (ChatGPT и аналоги).
    *   **Как это работает:**
        *   В БД загружаются векторные представления ваших внутренних документов (база знаний, документация).
        *   Когда пользователь задает вопрос, система сначала находит в векторной БД наиболее релевантные фрагменты документов.
        *   Эти фрагменты передаются в промпт LLM вместе с вопросом пользователя.
        *   LLM генерирует точный и актуальный ответ, основанный на предоставленной информации, а не только на своих исходных знаниях. Это решает проблему "галлюцинаций" и позволяет LLM работать с актуальными/приватными данными.


---
**Дополнительные ресурсы для изучения:**
*   [Документация Weaviate](https://weaviate.io/developers/weaviate)
*   [Статьи от Pinecone](https://www.pinecone.io/learn/)
*   [Репозиторий и документация pgvector](https://github.com/pgvector/pgvector)