# –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ PostgreSQL

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–ß—Ç–æ —Ç–∞–∫–æ–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ?](#—á—Ç–æ-—Ç–∞–∫–æ–µ-—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ)
2. [–ó–∞—á–µ–º –Ω—É–∂–Ω–æ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ?](#–∑–∞—á–µ–º-–Ω—É–∂–Ω–æ-—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ)
3. [–ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è](#–ø–ª—é—Å—ã-–∏-–º–∏–Ω—É—Å—ã-—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è)
4. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—é](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-–ø–æ–¥—Ö–æ–¥—ã-–∫-—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—é)
5. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ PostgreSQL](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è-–≤-postgresql)
6. [–ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#–ø—Ä–∏–º–µ—Ä—ã-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
7. [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏-–∏-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
8. [–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –ø–æ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—é –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ–ª–µ–∑–Ω—ã–µ-—Å—Å—ã–ª–∫–∏-–ø–æ-—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—é-–±–∞–∑-–¥–∞–Ω–Ω—ã—Ö)

## –ß—Ç–æ —Ç–∞–∫–æ–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ?

**–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ** (–æ—Ç –∞–Ω–≥–ª. shard - –æ—Å–∫–æ–ª–æ–∫) - —ç—Ç–æ –º–µ—Ç–æ–¥ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ partitioning –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è across multiple servers (—à–∞—Ä–¥–æ–≤) –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è. –ö–∞–∂–¥—ã–π —à–∞—Ä–¥ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –Ω–µ–∑–∞–≤–∏—Å–∏–º—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, —Å–æ–¥–µ—Ä–∂–∞—â—É—é –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–±—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:

- **–®–∞—Ä–¥** - –æ—Ç–¥–µ–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, —Ö—Ä–∞–Ω—è—â–∞—è —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- **–ö–ª—é—á —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è** - –ø–æ–ª–µ, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∫ —à–∞—Ä–¥—É
- **–®–∞—Ä–¥-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –º–æ—â–Ω–æ—Å—Ç–∏

## –ó–∞—á–µ–º –Ω—É–∂–Ω–æ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ?

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
   - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏
   - –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
   - –°–Ω–∏–∂–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫ –¥–ª—è –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

2. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ —Ö—Ä–∞–Ω–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   - –ü—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π single-node –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   - –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ç–∞–±–∞–π—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö

3. **–ü–æ–≤—ã—à–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏**
   - –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç–∫–∞–∑–æ–≤
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –≤–æ –≤—Ä–µ–º—è —Å–±–æ–µ–≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —à–∞—Ä–¥–æ–≤

### –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
- –°–∏—Å—Ç–µ–º—ã —Å –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π (—Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏, IoT)
- –ë–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

## –ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —à–∞—Ä–¥—ã
2. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** - –æ—Ç–∫–∞–∑ –æ–¥–Ω–æ–≥–æ —à–∞—Ä–¥–∞ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—Å—é —Å–∏—Å—Ç–µ–º—É
4. **–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** - –¥–∞–Ω–Ω—ã–µ –±–ª–∏–∂–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:

1. **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** - —Ç—Ä–µ–±—É–µ—Ç—Å—è careful planning
2. **–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ multiple databases
3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è JOIN** - —Å–ª–æ–∂–Ω—ã–µ –º–µ–∂—à–∞—Ä–¥–æ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
4. **–ü—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏** - distributed transactions
5. **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - —Å–ª–æ–∂–Ω–æ—Å—Ç—å rebalancing —à–∞—Ä–¥–æ–≤

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—é

### 1. Key-based (Hash-based) Sharding
```sql
-- –ü—Ä–∏–º–µ—Ä: —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ö—ç—à—É user_id
shard_id = hash(user_id) % total_shards
```

### 2. Range-based Sharding
```sql
-- –ü—Ä–∏–º–µ—Ä: —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç
shard_id = determine_shard_by_date_range(created_at)
```

### 3. Directory-based Sharding
```sql
-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ lookup-—Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —à–∞—Ä–¥–∞
shard_id = lookup_shard_id(customer_id)
```

### 4. Geographic Sharding
```sql
-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É
shard_id = determine_shard_by_region(user_region)
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ PostgreSQL

PostgreSQL –Ω–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥–æ–≤:

### –ü–æ–¥—Ö–æ–¥ 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è Citus

**Citus** - –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ PostgreSQL.

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Citus**:
```bash
# –î–ª—è Ubuntu/Debian
sudo apt-get install postgresql-15-citus

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ shared_preload_libraries
echo "shared_preload_libraries = 'citus'" >> /etc/postgresql/15/main/postgresql.conf
```

2. **–°–æ–∑–¥–∞–Ω–∏–µ coordinator –∏ worker nodes**:
```sql
-- –ù–∞ coordinator node
SELECT * from master_add_node('worker1.example.com', 5432);
SELECT * from master_add_node('worker2.example.com', 5432);
SELECT * from master_add_node('worker3.example.com', 5432);
```

3. **–°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã**:
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
CREATE TABLE events (
    event_id bigserial,
    user_id bigint,
    event_type text,
    created_at timestamptz
);

-- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
SELECT create_distributed_table('events', 'user_id');

-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —à–∞—Ä–¥–æ–≤
SELECT master_create_worker_shards('events', 16, 2);
```

### –ü–æ–¥—Ö–æ–¥ 2: –†—É—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü-–ø–∞—Ä—Ç–∏—Ü–∏–π –∏ FDW

#### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Foreign Data Wrappers
```sql
-- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
CREATE EXTENSION postgres_fdw;

-- –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞—Ä–¥–∞
CREATE SERVER shard1 FOREIGN DATA WRAPPER postgres_fdw 
OPTIONS (host 'shard1.example.com', dbname 'mydb', port '5432');

CREATE SERVER shard2 FOREIGN DATA WRAPPER postgres_fdw 
OPTIONS (host 'shard2.example.com', dbname 'mydb', port '5432');

-- –°–æ–∑–¥–∞–Ω–∏–µ user mapping
CREATE USER MAPPING FOR current_user
SERVER shard1 OPTIONS (user 'postgres', password 'password');

CREATE USER MAPPING FOR current_user
SERVER shard2 OPTIONS (user 'postgres', password 'password');
```

#### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ foreign tables
CREATE FOREIGN TABLE events_shard1 (
    event_id bigint,
    user_id bigint,
    event_type text,
    created_at timestamptz
) SERVER shard1 OPTIONS (table_name 'events');

CREATE FOREIGN TABLE events_shard2 (
    event_id bigint,
    user_id bigint,
    event_type text,
    created_at timestamptz
) SERVER shard2 OPTIONS (table_name 'events');

-- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, –æ–±—ä–µ–¥–∏–Ω—è—é—â–µ–≥–æ —à–∞—Ä–¥—ã
CREATE VIEW events AS
    SELECT * FROM events_shard1
    UNION ALL
    SELECT * FROM events_shard2;
```

#### –®–∞–≥ 3: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è router —Ñ—É–Ω–∫—Ü–∏–∏
```sql
CREATE OR REPLACE FUNCTION insert_event(
    p_user_id bigint,
    p_event_type text,
    p_created_at timestamptz
) RETURNS void AS $$
DECLARE
    v_shard_id int;
BEGIN
    -- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —à–∞—Ä–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ user_id
    v_shard_id = abs(mod(p_user_id, 2)) + 1;
    
    -- –í—Å—Ç–∞–≤–∫–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —à–∞—Ä–¥
    IF v_shard_id = 1 THEN
        INSERT INTO events_shard1 (user_id, event_type, created_at)
        VALUES (p_user_id, p_event_type, p_created_at);
    ELSE
        INSERT INTO events_shard2 (user_id, event_type, p_created_at)
        VALUES (p_user_id, p_event_type, p_created_at);
    END IF;
END;
$$ LANGUAGE plpgsql;
```

### –ü–æ–¥—Ö–æ–¥ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–≥–æ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```python
# –ü—Ä–∏–º–µ—Ä –Ω–∞ Python
import psycopg2
from hashlib import md5

class ShardManager:
    def __init__(self, shards):
        self.shards = shards
        self.connections = {}
        
    def get_shard_connection(self, shard_key):
        shard_id = self.get_shard_id(shard_key)
        if shard_id not in self.connections:
            conn = psycopg2.connect(**self.shards[shard_id])
            self.connections[shard_id] = conn
        return self.connections[shard_id]
    
    def get_shard_id(self, shard_key):
        # –ü—Ä–æ—Å—Ç–æ–π —Ö—ç—à-–∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —à–∞—Ä–¥–∞
        hash_val = int(md5(str(shard_key).encode()).hexdigest(), 16)
        return hash_val % len(self.shards)

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —à–∞—Ä–¥–æ–≤
shards_config = [
    {'host': 'shard1.example.com', 'dbname': 'mydb', 'user': 'postgres'},
    {'host': 'shard2.example.com', 'dbname': 'mydb', 'user': 'postgres'},
    {'host': 'shard3.example.com', 'dbname': 'mydb', 'user': 'postgres'}
]

shard_manager = ShardManager(shards_config)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
def save_event(user_id, event_type):
    conn = shard_manager.get_shard_connection(user_id)
    with conn.cursor() as cur:
        cur.execute(
            "INSERT INTO events (user_id, event_type) VALUES (%s, %s)",
            (user_id, event_type)
        )
    conn.commit()
```

## –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä 1: –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞—Ä–¥–µ
CREATE TABLE users (
    user_id bigserial PRIMARY KEY,
    username varchar(50) NOT NULL,
    email varchar(100) NOT NULL,
    created_at timestamptz DEFAULT now()
);

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —à–∞—Ä–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE OR REPLACE FUNCTION get_user_shard(user_id bigint)
RETURNS int AS $$
BEGIN
    RETURN (user_id % 4) + 1; -- 4 —à–∞—Ä–¥–∞
END;
$$ LANGUAGE plpgsql;

-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è mapping –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ —à–∞—Ä–¥–∞–º
CREATE TABLE user_shard_map (
    user_id bigint PRIMARY KEY,
    shard_id int NOT NULL,
    created_at timestamptz DEFAULT now()
);
```

### –ü—Ä–∏–º–µ—Ä 2: –ú–µ–∂—à–∞—Ä–¥–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Citus

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ reference —Ç–∞–±–ª–∏—Ü—ã (—Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –≤—Å–µ —à–∞—Ä–¥—ã)
CREATE TABLE countries (
    country_code char(2) PRIMARY KEY,
    country_name text NOT NULL
);

SELECT create_reference_table('countries');

-- –°–æ–∑–¥–∞–Ω–∏–µ distributed —Ç–∞–±–ª–∏—Ü—ã
CREATE TABLE users (
    user_id bigserial,
    country_code char(2),
    name text,
    email text
);

SELECT create_distributed_table('users', 'country_code');

-- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ —à–∞—Ä–¥–∞–º
SELECT c.country_name, COUNT(*) as user_count
FROM users u
JOIN countries c ON u.country_code = c.country_code
GROUP BY c.country_name
ORDER BY user_count DESC;
```

### –ü—Ä–∏–º–µ—Ä 3: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —à–∞—Ä–¥–∞–º–∏

```sql
-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –¥—Ä—É–≥–æ–π —à–∞—Ä–¥
CREATE OR REPLACE FUNCTION migrate_user(
    p_user_id bigint,
    p_new_shard_id int
) RETURNS void AS $$
DECLARE
    v_old_shard_id int;
    v_user_data jsonb;
BEGIN
    -- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —à–∞—Ä–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    SELECT shard_id INTO v_old_shard_id
    FROM user_shard_map
    WHERE user_id = p_user_id;
    
    -- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –Ω–∞ –Ω—É–∂–Ω–æ–º —à–∞—Ä–¥–µ
    IF v_old_shard_id = p_new_shard_id THEN
        RETURN;
    END IF;
    
    -- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ —Å—Ç–∞—Ä–æ–≥–æ —à–∞—Ä–¥–∞
    -- (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
    
    -- –í—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–æ–≤—ã–π —à–∞—Ä–¥
    -- (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
    
    -- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ mapping —Ç–∞–±–ª–∏—Ü—ã
    UPDATE user_shard_map
    SET shard_id = p_new_shard_id
    WHERE user_id = p_user_id;
    
    -- –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç–∞—Ä–æ–≥–æ —à–∞—Ä–¥–∞
    -- (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
    
    -- –ö–æ–º–º–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    -- –í–∞–∂–Ω–æ: —Ç—Ä–µ–±—É–µ—Ç—Å—è distributed transaction coordination
END;
$$ LANGUAGE plpgsql;
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –í—ã–±–æ—Ä –∫–ª—é—á–∞ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á —Å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º
- –ò–∑–±–µ–≥–∞–π—Ç–µ hot spots - —à–∞—Ä–¥–æ–≤ —Å –Ω–µ–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π
- –£—á–∏—Ç—ã–≤–∞–π—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
```sql
-- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ Citus
SELECT * FROM citus_shards;
SELECT * FROM citus_shard_placement;

-- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞ —à–∞—Ä–¥–æ–≤
SELECT nodename, nodeport, shardid, pg_size_pretty(shard_size)
FROM citus_shards
ORDER BY shard_size DESC;
```

### 3. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- –†–µ–∞–ª–∏–∑—É–π—Ç–µ coordinated backup across shards
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ point-in-time recovery –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞—Ä–¥–∞
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–µ–∂—à–∞—Ä–¥–æ–≤–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
- –†–µ–∞–ª–∏–∑—É–π—Ç–µ –µ–¥–∏–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- –û–±–µ—Å–ø–µ—á—å—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ –¥–≤–∏–∂–µ–Ω–∏–∏

### 5. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ connection pooling
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞—Ä–¥–µ
- –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### 6. –ú–∏–≥—Ä–∞—Ü–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ capacity –∑–∞—Ä–∞–Ω–µ–µ
- –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è rebalancing
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—ã–±–æ—Ä –ø–æ–¥—Ö–æ–¥–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

- **Citus** - –æ–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–æ–≥–∞—Ç—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- **FDW** - –≥–∏–±–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è custom-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
- **–ü—Ä–∏–∫–ª–∞–¥–Ω–æ–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –Ω–æ –≤—ã—Å–æ–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å

–ü–æ–º–Ω–∏—Ç–µ, —á—Ç–æ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ beyond the capabilities of a single PostgreSQL instance.

–ü–µ—Ä–µ–¥ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:
- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (–±–æ–ª–µ–µ –º–æ—â–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)
- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–ª—è —á—Ç–µ–Ω–∏—è
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∏–Ω–¥–µ–∫—Å–æ–≤
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è


# –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –ø–æ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—é –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

## üîç –û–±—â–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –∏ –≤–≤–µ–¥–µ–Ω–∏–µ –≤ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
1.  **[–ß—Ç–æ —Ç–∞–∫–æ–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö? (AWS)](https://aws.amazon.com/what-is/database-sharding/)** ‚Äî –±–∞–∑–æ–≤–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, –º–µ—Ç–æ–¥–æ–≤ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∏—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤. –û—Ç–ª–∏—á–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è.
2.  **[Database Sharding, Sharding Methods, Benefits, Drawbacks and Alternatives](https://medium.com/@bhat_aparna1/database-sharding-sharding-methods-benefits-drawbacks-and-alternatives-197a54943c18)** ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ–±–∑–æ—Ä –º–µ—Ç–æ–¥–æ–≤ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è, –∏—Ö –ø–ª—é—Å–æ–≤, –º–∏–Ω—É—Å–æ–≤ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤. –°—Ç–∞—Ç—å—è –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç hash-based, range-based, directory –∏ geography-based —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ.
3.  **[–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º (Habr)](https://habr.com/ru/companies/piter/articles/813133/)** ‚Äî –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è, –µ–≥–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ –∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤. –û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞–º joins, —Å—Å—ã–ª–æ—á–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.

## üìä –ú–µ—Ç–æ–¥—ã –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è
4.  **[–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ PostgreSQL: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–¥—Ö–æ–¥—ã (Proselyte)](https://proselyte.net/sharding-postgresql/)** ‚Äî –≥–ª—É–±–æ–∫–∏–π —Ä–∞–∑–±–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ PostgreSQL, –≤–∫–ª—é—á–∞—è range-based, hash-based —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π. –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã —Å–∏–ª—å–Ω—ã–µ –∏ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞.
5.  **[–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –†–µ–ø–ª–∏–∫–∞—Ü–∏—è. –ü–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ. –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (Habr)](https://habr.com/ru/articles/875708/)** ‚Äî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏, –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è. –ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞–Ω—ã –º–µ—Ç–æ–¥—ã —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è: range-based –∏ key-based (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ).

## üêò –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ PostgreSQL
6.  **[How to Implement Database Sharding in PostgreSQL](https://www.squash.io/tutorial-on-database-sharding-in-postgresql/)** ‚Äî –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ PostgreSQL. –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã —Ç–µ—Ö–Ω–∏–∫–∏ partitioning, replication, distributed queries –∏ connection pooling. –ü—Ä–∏–≤–µ–¥–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –¥–ª—è range –∏ list partitioning.
7.  **[Sharding Your Data With PostgreSQL 11](https://pgdash.io/blog/postgres-11-sharding.html)** ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ foreign data wrappers (FDW) –¥–ª—è —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL 11. –ü–æ–∫–∞–∑–∞–Ω–æ, –∫–∞–∫ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å partitioning –∏ FDW.
8.  **[–õ–æ–∫–∞–ª—å–Ω–æ–µ –∏ —É–¥–∞–ª–µ–Ω–Ω–æ–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ / –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ PostgreSQL (Medium)](https://medium.com/@it-kachalka-david-shekunts/%D0%BB%D0%BE%D0%BA%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D0%B8-%D1%83%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%BD%D0%BE%D0%B5-%D1%88%D0%B0%D1%80%D0%B4%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BF%D0%B0%D1%80%D1%82%D0%B8%D1%86%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B2-postgresql-9de91ad602e6)** ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ (–ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ) –∏ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ (—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ) —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL. –ü—Ä–∏–≤–µ–¥–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã SQL-–∫–æ–¥–∞ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±–æ–∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –∏ –æ–±—Å—É–∂–¥–µ–Ω—ã –∏—Ö –ø—Ä–æ–±–ª–µ–º—ã.
9.  **[How to Configure PostgreSQL Sharding with ClusterControl](https://severalnines.com/blog/how-configure-postgresql-sharding-clustercontrol/)** ‚Äî –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ PostgreSQL —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º partitioning –∏ foreign data wrapper (FDW) —á–µ—Ä–µ–∑ ClusterControl. –í–∫–ª—é—á–∞–µ—Ç –ø—Ä–∏–º–µ—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—è partitioned tables –∏ foreign tables.

## üíª –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
10. **[–ë–∞–∑–∞ –ø–æ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—é –±–∞–∑—ã (Habr / Ozon Tech)](https://habr.com/ru/companies/ozontech/articles/705912/)** ‚Äî –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è PostgreSQL –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞ Go. –†–∞–∑–±–∏—Ä–∞–µ—Ç—Å—è –∫–æ–¥ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ —à–∞—Ä–¥–∞–º, –∏—Ö —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏. –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –º–µ—Ç–æ–¥—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —à–∞—Ä–¥–∞ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

---

**üí° –°–æ–≤–µ—Ç—ã –ø–æ –∏–∑—É—á–µ–Ω–∏—é:**
*   –ï—Å–ª–∏ –≤—ã —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç–µ, –Ω–∞—á–Ω–∏—Ç–µ —Å –æ–±—â–∏—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π ([1](https://aws.amazon.com/what-is/database-sharding/), [2](https://medium.com/@bhat_aparna1/database-sharding-sharding-methods-benefits-drawbacks-and-alternatives-197a54943c18)).
*   –î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ PostgreSQL –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã [6](https://www.squash.io/tutorial-on-database-sharding-in-postgresql/), [7](https://pgdash.io/blog/postgres-11-sharding.html) –∏ [10](https://severalnines.com/blog/how-configure-postgresql-sharding-clustercontrol/).
*   –î–ª—è –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞—é—Ç –≤ –±–æ–ª—å—à–∏—Ö –∫–æ–º–ø–∞–Ω–∏—è—Ö, –ø–æ–ª–µ–∑–Ω–∞ —Å—Ç–∞—Ç—å—è –æ—Ç Ozon Tech ([10](https://habr.com/ru/companies/ozontech/articles/705912/)).

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É. –í—Å–µ–≥–¥–∞ –æ—Ü–µ–Ω–∏–≤–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—è —Å–Ω–∞—á–∞–ª–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∏–Ω–¥–µ–∫—Å–æ–≤, –∞ —Ç–∞–∫–∂–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é.